#!/bin/bash
# –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º —Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º app
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./scripts/diagnose-app-container.sh

set -e

echo "üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ app..."
echo ""

echo "üìä 1. –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:"
echo "================================"
docker-compose ps
echo ""

echo "üìã 2. –î–µ—Ç–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ app:"
echo "======================================="
docker ps -a | grep lec7-app || echo "‚ö†Ô∏è  –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä app –Ω–µ –Ω–∞–π–¥–µ–Ω"
echo ""

echo "üìù 3. –õ–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ app (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫):"
echo "================================================="
docker-compose logs app --tail=100 || docker logs lec7-app --tail=100 2>&1 || echo "‚ö†Ô∏è  –õ–æ–≥–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã"
echo ""

echo "üîß 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è:"
echo "====================================="
docker-compose exec app env 2>/dev/null | grep -E "(DATABASE_URL|NODE_ENV|PORT)" || echo "‚ö†Ô∏è  –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è"
echo ""

echo "üíæ 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞:"
echo "========================================"
df -h
echo ""

echo "üê≥ 6. –°—Ç–∞—Ç—É—Å Docker:"
echo "==================="
docker info | grep -E "(Containers|Running|Paused|Stopped)" || docker ps -a --format "table {{.Names}}\t{{.Status}}\t{{.Image}}"
echo ""

echo "‚úÖ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
